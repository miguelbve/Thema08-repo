---
title: 'Thema08-week1-mRNA '
author: "Jurrien de Jong"
date: "`r Sys.Date()`"
output:
  pdf_document:
    number_sections: yes
  html_document:
    df_print: paged
header-includes:
- \usepackage{longtable}
- \usepackage{hyperref}
linkcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
Introduction of the research and introduction research questions

## Goal
  - Describe Goal (not the educational goal but the research goal)
  - Describe how you reach the goal (e.g. make model and figures, use different setting)
  - formulate hypothesis

## Theory

- Describe biological model
- Picture of the biological model

```{r, echo=FALSE, out.width='95%'}
#knitr::include_graphics('example.png')
```
Give an explanation of the model with citations of source \cite{Soertaert10} (replace this with actual source)
and formula explanation

$$\frac{\delta R}{\delta t} = -r * R + m $$
Describe each element and the transformations

# Methods
Over het algemeen biedt de mediaan een beter idee van de data verdeling, bij steekproefproefgemiddelden mits zij een normaal verdeling volgen. Aangezien de mediaan robuuster is dan een gemiddelde (mean), want het is minder afhankelijk van uitbijters/uitschieters, omdat het het middelste punt is van een gesorteerde reeks cijfers/getallen/gegevens en de scores niet worden gedeeld door het aantal n. Een goede illustratie zegt meer dan duizend woorden, om die reden is het beter om een grafiek van de mediaan erbij te plotten.

## The software model

- Describe the software tools used, as well as the libraries
- Describe the software implementation (note: code below is an example)
```{r}
library(deSolve)
# code
```

## Model configuration

Explain chosen initial state, parameter values and time sequence. Use tables with values as for example below
\begin{longtable}[l]{l|l|l}
\caption{Parameter Values} \\ \hline
\label{param_table}
$\textbf{Parameter}$             &$\textbf{Value}$& $\textbf{Unit}$              \\ \hline
\endhead
$a$       & 0.08  & $hour^{-1}$         \\ \hline
$b$       & 0.06  & $hour^{-1}$         \\ \hline
$c$       & 0.06  & $hour^{-1}$         \\ \hline
\end{longtable}

# Results

De vragen die opkomen tijdens het onderzoeken van een biologisch systeem zal je kunnen beantwoorden
aan de hand van een gecreerd model. Hieronder is de code te zien dat zo'n soort model kan produceren:

```{r results}
data <- read.csv("MPL.csv", na.strings = "NA")

medians <- aggregate(data[,c("MPL_conc","mRNA","Free_receptor")],list(data$dose,data$time), median, na.rm=T)
names(medians)[1:2] <- c("dose","time")
medians_01 <- subset(medians, dose == 0.1 | dose == 0)
medians_03 <- subset(medians, dose == 0.3 | dose == 0)
```


```{r}
# this function calculates the derivatives and returns it as a list.
Glucocorticoid_func <- function(t, y, parms) {
    with(as.list(c(y, parms)),{
      
      # Dit model bevat 4 afgeleide functies:
      # Afgeleide 1:
  
      dmRNAr_dt <- ks_Rm * ( 1 - (DRN / (IC50_Rm + DRN))) - kd_Rm * mRNAr
  
      # Afgeleide 2:
  
      dR_dt <- ks_r * mRNAr + Rf * kre * DRN - kon * D * R - kd_R * R
      
      # Afgeleide 3:
  
      dDR_dt <- kon * D * R - kT * DR
  
      # Afgeleide 4:
  
      dDRN_dt <- kT * DR - kre * DRN
      
      return(list(c(dmRNAr_dt, dR_dt, dDR_dt, dDRN_dt)))
       }
       )
}
```

```{r}
par(mfrow = c(2,2) )

# Set initial values
state <- c(mRNAr = 4.74, R = 267, DR = 0, DRN = 0)
t <- seq(0, 168, by = 1)

# -----------------------------------------------
# Dose 0.1

parameters_01 <- c(ks_Rm = 2.90, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 0.612, ks_r = 3.22, D = 39.0, Rm0 = 4.74,
                DR = 0, DRN = 0)

out_01 <- deSolve::ode(times = t, y = state, parms = parameters_01,
                    func = Glucocorticoid_func, method = "lsoda")

out_01 <- as.data.frame(out_01)

plot(out_01$time, out_01$mRNAr,
     main="Receptor mRNA by dose 0.1",
     ylab=c("nmol/L"), xlab=c(" Time in hours"),
     type='l', lwd = 2, xlim= c(0,60), ylim= c(0,5))

lines(data$time, data$mRNA, type = "p")
lines(medians_01$time, medians_01$mRNA, type = "l", col= "red")

plot(out_01$time, out_01$R,
     main="Free receptor mRNA by dose 0.1",
     ylab=c("nmol/L"), xlab=c(" Time in hours"),
     type='l', lwd = 2, xlim= c(0,60), ylim= c(0,500))

lines(data$time, data$Free_receptor, type = "p")
lines(medians_01$time, medians_01$Free_receptor, type = "l", col= "red")

# -----------------------------------
# Dose 0.3

parameters_03 <- c(ks_Rm = 2.90, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 0.612, ks_r = 3.22, D = 107, Rm0 = 4.74,
                DR = 0, DRN = 0)

out_03 <- deSolve::ode(times = t, y = state, parms = parameters_03,
                    func = Glucocorticoid_func, method = "lsoda")

out_03 <- as.data.frame(out_03)

plot(out_03$time, out_03$mRNAr,
     main="Receptor mRNA by dose 0.3",
     ylab=c("nmol/L"), xlab=c(" Time in hours"),
     type='l', lwd = 2, xlim= c(0,60), ylim= c(0,5))

lines(data$time, data$mRNA, type = "p")
lines(medians_01$time, medians_01$mRNA, type = "l", col= "red")

plot(out_03$time, out_03$R,
     main="Free receptor mRNA by dose 0.3",
     ylab=c("nmol/L"), xlab=c(" Time in hours"),
     type='l', lwd = 2, xlim= c(0,60), ylim= c(0,500))

lines(data$time, data$Free_receptor, type = "p")
lines(medians_01$time, medians_01$Free_receptor, type = "l", col= "red")
```
VRAAGSTELLING:
Are the results of the model in line with experimental data? If not, what could be the reason? 
Think of at least one explanation. 
EINDANTWOORD:
De resultaten van het model (zwart) komen wel overeen met elkaar, aangezien de gefitte lijnen (rode experiment data) een gevolg zijn van de data observaties
(zwarte model data). Het onderlinge verschil tussen de twee model zwarte model-lijnen is
mogelijk te verklaren door het onderlinge verschil in condities van model groepen (sample groups).
Omdat een hogere drug concentratie leidt tot verhoogde kans van bindingen met mRNA receptoren
zal de concentratie mRNA bezette receptoren bij een hogere dosis (0.3 ipv 0.1) sneller afnemen
in een bepaalde tijd (zie fig Receptor mRNA by dose 0.3) dan bij een lagere dosis (zie fig Receptor mRNA by dose 0.1)
Dat verschil is af te leiden tussen de grafieken!

KOMT MISS VAN PAS
```{r a1q3}
# summary(data)
# Notitie: dose numerieke waardes worden nu karakter waardes
# data$dose <- as.character(data$dose)
# stack(data$dose, select=c("0", "0.1", "0.3")
```

Question 2.4

```{r}
parameters <- c(ks_Rm = 0, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 0.612, ks_r = 3.22, D = 53, Rm0 = 4.74,
                DR = 0, DRN = 0)

t = seq(0, 20, by = 0.1)

out <- deSolve::ode(times = t, y = state, parms = parameters,
                    func = Glucocorticoid_func, method = "lsoda")


out <- as.data.frame(out)

plot(out$time, out$mRNAr, type = "l", lwd = 3, xlab = "Time in hours", ylab = "nmol/L")
```

Question 2.5

```{r}
t <- seq(0, 50, by = 0.1)

parameters_1 <- c(ks_Rm = 2.90/5, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 2.9/5/4.74, ks_r = 3.22, D = 53, Rm0 = 4.74,
                DR = 0, DRN = 0)

parameters_2 <- c(ks_Rm = 2.90/2, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 2.9/2/4.74, ks_r = 3.22, D = 53, Rm0 = 4.74,
                DR = 0, DRN = 0)

parameters_3 <- c(ks_Rm = 2.90*2, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 2.9*2/4.74, ks_r = 3.22, D = 53, Rm0 = 4.74,
                DR = 0, DRN = 0)

parameters_4 <- c(ks_Rm = 2.90*5, IC50_Rm = 26.2, kon = 0.00329,
                kT = 0.63, kre = 0.57, Rf = 0.49, kd_R = 0.0572,
                kd_Rm = 2.9*5/4.74, ks_r = 3.22, D = 53, Rm0 = 4.74,
                DR = 0, DRN = 0)

out_1 <- deSolve::ode(times = t, y = state, parms = parameters_1,
                    func = Glucocorticoid_func, method = "lsoda")

out_2 <- deSolve::ode(times = t, y = state, parms = parameters_2,
                    func = Glucocorticoid_func, method = "lsoda")

out_3 <- deSolve::ode(times = t, y = state, parms = parameters_3,
                    func = Glucocorticoid_func, method = "lsoda")

out_4 <- deSolve::ode(times = t, y = state, parms = parameters_4,
                    func = Glucocorticoid_func, method = "lsoda")

out_1 <- as.data.frame(out_1)
out_2 <- as.data.frame(out_2)
out_3 <- as.data.frame(out_3)
out_4 <- as.data.frame(out_4)

plot(out_1$time, out_1$mRNAr,
     main="Rate of production of mRNA scenarios",
     ylab=c("nmol/L"), xlab=c(" Time in hours"),
     type='l', lwd = 2, xlim= c(0,50), ylim= c(5, 0))

lines(out_2$time, out_2$mRNAr, lwd = 2, col = "red")
lines(out_3$time, out_3$mRNAr, lwd = 2, col = "blue")
lines(out_4$time, out_4$mRNAr, lwd = 2, col = "purple")

legend(39, 0, legend=c("Simulation-1", "Simulation-2", "Simulation-3", "Simulation-4"),
       col=c("black", "red", "blue", "purple"), lty=1, cex=0.8,
       title="Legend", text.font=4, bg='gray')
```

- Describe what can be seen in such way that it leads to an answer to your research questions
- Give your figures a number and a descriptive title.
- Provide correct axis labels (unit and quantity), legend and caption.
- Always refer to and discuss your figures and tables in the text - they never stand alone.


# Discussion and Conclusion
## Discussion
- Compare your results with what is expecting from the literature and discuss differences with them.
- Discuss striking and surprising results.
- Discuss weaknesses in your research and how they could be addressed.

## General conclusion and perspective
Discuss what your goal was, what the end result is and how you could continue working from here.


\begin{thebibliography}{9}

\bibitem{Soertaert10}
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R.: \textit{Solving differential equations in R: package deSolve}, J. Stat. Softw., 33, 1-25, 2010.

Soetaert, K., Petzoldt, T., and Woodrow Setzer, R.: \textit{Solving differential equations in R: package deSolve}, J. Stat. Softw., 33, 1-25, 2010.

\end{thebibliography}
